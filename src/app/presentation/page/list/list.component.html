<div *ngIf="uploadApiService.uploads.length > 0" class="gallery uploads">
    <div *ngFor="let upload of uploadApiService.uploads$ | async; let index = index" class="preview">
        <img [src]="upload.preview.previewImage" *ngIf="upload.preview.isImage"/>
        <video *ngIf="upload.preview.isVideo" controls>
            <source [src]="upload.preview.previewImage" [type]="upload.preview.file.type">
        </video>
        <mat-progress-bar
            *ngIf="upload.upload$ | async as upload"
            [mode]="upload.state == 'PENDING' ? 'buffer' : 'determinate'"
            [value]="upload.progress"
        >
        </mat-progress-bar>
        <p>{{ upload.preview.file.name }}</p>
    </div>
    <hr>
</div>
<div *ngIf="userDataServiceService.isLoggedIn$ | async" class="gallery">
    <ng-container *ngIf="(galleryDataService.documents$ | async) as documents; else loading">
        <a *ngFor="let image of documents; trackBy: getDocumentId"
           [routerLink]="['', {relativeUrl: true, outlets: {overlay: ['details', image.id]}}]">
            <picture>
                <source
                    *ngFor="let preview of image.previews"
                    media="(min-width: 10px)"
                    [srcset]="preview.path"
                    [type]="preview.mime"
                    loading="lazy"
                />
                <img [src]="image.previews[0]?.path ?? '/api/document-preview/' + image.id" loading="lazy"/>
            </picture>
        </a>
    </ng-container>
    <ng-template #loading>
        <mat-icon>loading</mat-icon>
    </ng-template>
</div>

<div class="bottom-bar">
    <button mat-fab color="primary" title="Filter">
        <mat-icon>filter_list</mat-icon>
    </button>
    <button mat-fab extended (click)="showUpload()">
        <mat-icon>upload</mat-icon>
        Upload
    </button>
</div>
